function i(e){try{const r=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(t){return console.error("Error decodificando token:",t),null}}function s(){return localStorage.getItem("token")}async function c(e){try{return(await fetch(`https://apipris.kysedomi.lat/auth/verify?token=${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).status===200}catch(t){return console.error("Error verificando token:",t),!1}}function a(){const e=s();return e?i(e):null}function l(){const e=a();return e&&e.is_admin===!0}function d(){const e=a();return e?e.id:null}async function u(e,t){try{const r=t?`https://apipris.kysedomi.lat/admin/user/${e}`:`https://apipris.kysedomi.lat/clients/user/${e}`,n=await fetch(r);return n.status===200?await n.json():(console.error("Error obteniendo datos del usuario"),null)}catch(r){return console.error("Error en getUserData:",r),null}}async function p(){const e=s();if(!e)return null;try{if(!await c(e))return localStorage.removeItem("token"),null;const r=a();if(!r||!r.id)return console.error("Token payload es inv√°lido"),null;const n=r.id,o=l();return await u(n,o)}catch(t){return console.error("Error en checkAuthentication:",t),null}}function f(){localStorage.removeItem("token")}export{p as c,d as g,l as i,f as l};
