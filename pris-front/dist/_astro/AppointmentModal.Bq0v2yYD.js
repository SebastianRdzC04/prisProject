import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.BVOCwoKb.js";import{g as b}from"./security.DPbZ2g5Y.js";const j=()=>{const[t,l]=a.useState({type:"consulta",date:"",time:"",client_id:""}),[o,m]=a.useState(null),[f,g]=a.useState(!1),[i,p]=a.useState(!1),[s,h]=a.useState(!0);a.useEffect(()=>{const d=b()||"3fa85f64-5717-4562-b3fc-2c963f66afa6";(async()=>{try{h(!0);const r=await fetch(`https://apipris.kysedomi.lat/clients/user/${d}`);if(!r.ok)throw new Error("No se pudo obtener la información del cliente");const u=await r.json();console.log("ID del cliente:",u),l(x=>({...x,client_id:u.id}))}catch(r){console.error("Error al obtener ID de cliente:",r),m("No se pudo obtener la información del cliente. Intente más tarde."),l(u=>({...u,client_id:d}))}finally{h(!1)}})()},[]);const c=d=>{const{name:n,value:r}=d.target;l({...t,[n]:r})},y=async d=>{d.preventDefault(),p(!0),m(null);try{const n={type:t.type,date:t.date,time:t.time,client_id:t.client_id};console.log("Enviando datos:",n);const r=await fetch("https://apipris.kysedomi.lat/dates/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const x=await r.json();throw new Error(x.detail||x.message||"Error al crear la consulta")}const u=await r.json();console.log("Respuesta del servidor:",u),g(!0),l({type:"consulta",date:"",time:"",client_id:t.client_id}),setTimeout(()=>g(!1),3e3)}catch(n){m(n instanceof Error?n.message:"Error desconocido al crear la consulta"),console.error("Error:",n)}finally{p(!1)}};return e.jsxs("div",{className:"w-full",children:[o&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:o}),f&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:"¡Consulta creada exitosamente!"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[s&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 text-blue-700 rounded-lg",children:"Cargando información del cliente..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700",children:"Tipo de Consulta:"}),e.jsxs("select",{id:"type",name:"type",value:t.type,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-700",required:!0,children:[e.jsx("option",{value:"consulta",children:"Primera Consulta"}),e.jsx("option",{value:"seguimiento",children:"Seguimiento"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Fecha:"}),e.jsx("input",{type:"date",id:"date",name:"date",value:t.date,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-700",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700",children:"Hora:"}),e.jsx("input",{type:"time",id:"time",name:"time",value:t.time,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-700",required:!0})]}),e.jsx("button",{type:"submit",disabled:i||s,className:`w-full py-2 px-4 rounded-md text-white font-medium ${i||s?"bg-gray-400 cursor-not-allowed":"bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-offset-2"}`,children:i?"Enviando...":"Crear Consulta"})]})]})},C=({isOpen:t,onClose:l,clientId:o})=>{const[m,f]=a.useState(null),[g,i]=a.useState(null);return a.useEffect(()=>{if(o){f(o);return}t&&!o&&(async()=>{try{const s=b();if(!s||s==="3fa85f64-5717-4562-b3fc-2c963f66afa6"){i("No se ha iniciado sesión");return}const h=await fetch(`https://apipris.kysedomi.lat/clients/user/${s}`);if(!h.ok)throw new Error("No se pudo obtener la información del cliente");const c=await h.json();console.log("ID del cliente:",c),f(c.id),i(null)}catch(s){console.error("Error al obtener ID de cliente:",s),i("No se pudo obtener la información del cliente. Intente más tarde."),f(null)}})()},[t,o]),t?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:l}),e.jsxs("div",{className:"bg-white rounded-lg shadow-xl z-10 w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-6 space-y-6 bg-white rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Agendar Nueva Cita"}),g?e.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded",children:[e.jsx("p",{className:"font-bold",children:"Error"}),e.jsx("p",{children:g})]}):!o&&!m?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gray-900"}),e.jsx("span",{className:"ml-2",children:"Cargando información..."})]}):e.jsx(j,{})]})]})]}):null};export{C as default};
